<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ZXing JS Browser</title>
  <link href="/static/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>

<div class="d-flex justify-content-center align-items-center">
  <video width="360" height="480">
  </video>
</div>

<script src="/static/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/@zxing/browser@latest"></script>
<script type="text/javascript">
  window.addEventListener('load', async () => {
    const codeReader = new ZXingBrowser.BrowserQRCodeReader();
    console.log("codeReader")
    console.log(codeReader)
    const videoInputDevices = await ZXingBrowser.BrowserCodeReader.listVideoInputDevices();
    console.log("videoInputDevices")
    console.log(videoInputDevices)
    alert(JSON.stringify(videoInputDevices))

    let selectedDeviceId = videoInputDevices[0].deviceId;
    videoInputDevices.forEach(device => {
      if (device.label.toLowerCase().includes("back")) {
        selectedDeviceId = device.deviceId
      }
    })
    console.log("selectedDeviceId")
    console.log(selectedDeviceId)
    const previewElem = document.querySelector('video');
    const controls = await codeReader.decodeFromVideoDevice(selectedDeviceId, previewElem, (result, error, controls) => {
      if (result !== undefined) {
        alert(result.text)
      }
    });

    setTimeout(() => {
      console.log("STOPPED Scanning")
      controls.stop()
    }, 10 * 60 * 1000);
  });
</script>
</body>
</html>